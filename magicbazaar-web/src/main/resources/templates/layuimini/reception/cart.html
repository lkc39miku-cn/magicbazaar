<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <title>Aroma Shop - Cart</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/all.min.css" rel="stylesheet">
    <link href="/css/themify-icons.css" rel="stylesheet">
    <link href="/css/style1.css" rel="stylesheet">
    <link href="/css/owl.theme.default.min.css" rel="stylesheet">
    <link href="/css/owl.carousel.min.css" rel="stylesheet">
    <link href="/css/nice-select.css" rel="stylesheet">
    <link href="/css/nouislider.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <style>
        .delete {
            width: 20px;
            height:5px;
            background: skyblue;
            transform: rotate(45deg);
        }
        .delete:after {
            content:'';
            display:block;
            width: 20px;
            height:5px;
            background: skyblue;
            transform: rotate(-90deg);
        }
        .online {
            height: 58px;
            line-height: 58px;
            border-radius: 50%;
            position: fixed;
            right: 20px;
            bottom: 10px;
        }
    </style>
</head>
<body>
<!--================ Start Header Menu Area =================-->
<header class="header_area">
    <div class="main_menu">
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container">
                <a class="navbar-brand logo_h" href="/reception/index"><img alt="" src="/picture/logo.png"></a>
                <button aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"
                        class="navbar-toggler" data-target="#navbarSupportedContent" data-toggle="collapse"
                        type="button">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="collapse navbar-collapse offset" id="navbarSupportedContent">
                    <ul class="nav navbar-nav menu_nav ml-auto mr-auto">
                        <li class="nav-item"><a class="nav-link" href="/reception/url/index">主页</a></li>
                        <li class="nav-item"><a class="nav-link" href="/reception/url/category">购物</a></li>
<!--                        <li class="nav-item"><a class="nav-link" href="/reception/url/stars">收藏</a></li>-->
                        <li class="nav-item"><a class="nav-link" href="/reception/url/singleblog">订单</a></li>
                    </ul>

                    <ul class="nav-shop">
                        <li class="nav-item">
                            <button><a href="/reception/url/cart"><i class="ti-shopping-cart"></i><span
                                    class="nav-shop__circle"></span></a></button>
                        </li>
                        <li class="nav-item user-center"><a class="button button-header" href="/reception/url/blog">个人中心</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
</header>
<!--================ End Header Menu Area =================-->

<!-- ================ start banner area ================= -->
<section class="blog-banner-area" id="blog" style="overflow: hidden">
    <img alt="" src="/images/backtop.jpg" style="width: 100%;margin-top: -500px;opacity: 0.1;">
    <div class="container h-100">
        <div class="blog-banner">
            <div class="text-center">
                <h1>购物车</h1>
                <nav aria-label="breadcrumb" class="banner-breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">主页</a></li>
                        <li aria-current="page" class="breadcrumb-item active">购物车</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</section>
<!-- ================ end banner area ================= -->


<!--================Cart Area =================-->
<section class="cart_area">
    <div class="container">
        <div class="cart_inner">
            <div class="table-responsive">
                <table class="table cart-table">
                </table>
            </div>
        </div>
    </div>
</section>
<!--================End Cart Area =================-->


<!--================ Start footer Area  =================-->
<footer>
    <div class="footer-area footer-only">
        <div class="container">
            <div class="row section_gap">
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="single-footer-widget tp_widgets ">
                        <h4 class="footer_title large_title">关于我们</h4>
                        <p>
                            So seed seed green that winged cattle in. Gathering thing made fly you're no
                            divided deep moved us lan Gathering thing us land years living.
                        </p>
                        <p>
                            So seed seed green that winged cattle in. Gathering thing made fly you're no divided deep
                            moved
                        </p>
                    </div>
                </div>
                <div class="offset-lg-1 col-lg-2 col-md-6 col-sm-6">
                    <div class="single-footer-widget tp_widgets">
                        <h4 class="footer_title">快速链接</h4>
                        <ul class="list">
                            <li><a href="/reception/url/index">主页</a></li>
                            <li><a href="/reception/url/category">购物</a></li>
                            <li><a href="/reception/url/stars">收藏</a></li>
                            <li><a href="/reception/url/singleblog">订单</a></li>
                            <li><a href="/reception/url/blog">个人中心</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6 col-sm-6">
                    <div class="single-footer-widget instafeed">
                        <h4 class="footer_title">画廊</h4>
                        <ul class="list instafeed d-flex flex-wrap">
                            <li style="width: 70px;height: 70px;"><img style="width: 100%;height: 100%" alt="" src="/images/84910587-4.jpg"></li>
                            <li style="width: 70px;height: 70px;"><img style="width: 100%;height: 100%" alt="" src="/images/84910587-4_fe7fc0b0.jpg"></li>
                            <li style="width: 70px;height: 70px;"><img style="width: 100%;height: 100%" alt="" src="/images/93473348-2.jpg"></li>
                            <li style="width: 70px;height: 70px;"><img style="width: 100%;height: 100%" alt="" src="/images/96721607-2.jpg"></li>
                            <li style="width: 70px;height: 70px;"><img style="width: 100%;height: 100%" alt="" src="/images/97206605-2.jpg"></li>
                            <li style="width: 70px;height: 70px;"><img style="width: 100%;height: 100%" alt="" src="/images/97206605-2_b20c87c9.jpg"></li>
                        </ul>
                    </div>
                </div>
                <div class="offset-lg-1 col-lg-3 col-md-6 col-sm-6">
                    <div class="single-footer-widget tp_widgets">
                        <h4 class="footer_title">联系我们</h4>
                        <div class="ml-40">
                            <p class="sm-head">
                                <span class="fa fa-location-arrow"></span>
                                总公司
                            </p>
                            <p>a243, ShuangHe Street, ZhengZhou City</p>

                            <p class="sm-head">
                                <span class="fa fa-phone"></span>
                                手机号码
                            </p>
                            <p>
                                +86 189 3729 9235 <br>
                                +86 195 4562 5076
                            </p>

                            <p class="sm-head">
                                <span class="fa fa-envelope"></span>
                                邮箱
                            </p>
                            <p>
                                3304079457@qq.com <br>
                                www.magicbazaar.top
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer-bottom">
        <div class="container">
            <div class="row d-flex">
                <p class="col-lg-12 footer-text text-center">
                    Copyright &copy; 2021.Company Overidea All rights reserved
                </p>
            </div>
        </div>
    </div>
</footer>
<button class="layui-btn layui-bg-blue online"><i class="layui-icon layui-icon-username"></i></button>

<!--================ End footer Area  =================-->

<form action="/reception/alipay/pay" method="post" hidden>
    <input type="text" name="totalAmount">
    <input type="text" name="idList">
    <input type="text" name="addressId">
    <button type="submit" class="alipay-btn"></button>
</form>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
<script src="/js/skrollr.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/jquery.nice-select.min.js"></script>
<script src="/js/jquery.ajaxchimp.min.js"></script>
<script src="/js/mail-script.js"></script>
<script src="/js/main.js"></script>
<script charset="utf-8" src="/lib/layui-v2.6.3/layui.js"></script>
<script charset="utf-8" src="/js/lay-config.js?v=2.0.0"></script>
<link href="/lib/layui-v2.6.3/css/layui.css" media="all" rel="stylesheet">
<script>
    function loadAddress() {
        const address = $('.address-select');
        $.ajax({
            type: 'post',
            url: '/reception/user/addressinfo',
            success: function (result) {
                console.log(result.data);
                address.empty();
                if (result.success) {
                    address.append('<option value="">请选择</option>');
                    $.each(result.data, function (i, object) {
                        address.append('<option value="' + object.id + '">姓名：' + object.userName + '\t地址：' + object.addressName + '\t手机号：' + object.phone + '</option>')
                    })
                } else {
                    address.append('<option value="">你还没有登录，请登录</option>');
                }
            }
        })
    }

    $(function () {
        $.ajax({
            type: 'post',
            url: '/reception/user/checklogin',
            success: function (result) {
                if (result.success) {
                    $('.user-center').append('<a class="button button-header logout-btn" href="javascript:">登出</a>')
                }
            }
        })

        $('.online').on('click', function () {
            layer.open({
                type: 2,
                title: '在线咨询',
                area: ['380px', '90%'],
                content: '/reception/url/online',
                shade: 0

            });
        })

        $(document).on('click', '.logout-btn', function () {
            $.ajax({
                type: 'post',
                url: '/reception/token/logout',
                success: function (result) {
                    if (result.success) {
                        layer.msg('注销成功', {
                            end: function () {
                                window.location.href = '/reception/login';
                            }
                        })
                    }
                }
            })
        })

        loadCart();

        $(document).on('click', '.all', function () {
            const check = $(this).prop('checked');
            $('.all-item').prop('checked', check);
            loadPrice();
        })

        $(document).on('click', '.all-item', function () {
            const checked = $('.all-item:checked').length;
            const all = $('.all-item').length;
            const check = checked === all;
            $('.all').prop('checked', check);
            loadPrice();
        })

        $(document).on('click', '.add-num', function () {
            const result = $(this).prev();
            result.val(parseInt(result.val()) + 1);

            $(this).parent().parent().next().children().text(parseInt($(this).prev().val()) * parseInt($(this).parent().parent().prev().children().text()) + '元');

            $.ajax({
                url: '/reception/commodity/addcart',
                type: 'post',
                dataType: 'json',
                data: {
                    commodityId: $(this).val()
                },
                success: function () {
                    loadPrice();
                }
            })
        })

        $(document).on('click', '.delete-btn', function () {
            const that = $(this);
            layer.confirm('真的要删除吗？', function (index) {
                $.ajax({
                    url: '/reception/commodity/deletecart',
                    type: 'post',
                    dataType: 'json',
                    data: {
                        commodityId: that.val()
                    },
                    success: function (result) {
                        if (result.success) {
                            cartNum();
                            loadPrice();
                            that.parent().parent().remove();
                            layer.msg(result.msg);
                            layer.close(index);
                        }
                    }
                })
            })
        })

        $(document).on('click', '.sub-num', function () {
            if (parseInt($(this).prev().prev().val()) === 1) {
                return;
            }

            const result = $(this).prev().prev();
            result.val(parseInt(result.val()) - 1)

            $(this).parent().parent().next().children().text(parseInt($(this).prev().prev().val()) * parseInt($(this).parent().parent().prev().children().text()) + '元');

            $.ajax({
                url: '/reception/commodity/addcart',
                type: 'post',
                dataType: 'json',
                data: {
                    commodityId: $(this).val(),
                    sub: true
                },
                success: function () {
                    loadPrice();
                }
            })
        })

        $(document).on('click', '.buy', function () {
            const check = $('.all-item:checked');
            const checked = check.length
            if (checked > 0) {
                let id = '';
                check.each(function () {
                    id += $(this).val() + ',';
                })

                if ($('.address-select').val() === '') {
                    layer.msg('请选择地址');
                    return;
                }

                layer.confirm('确定要购买物品吗？', function (index) {
                    $('input[name="totalAmount"]').val(parseInt($('.all-price').text()));
                    $('input[name="idList"]').val(id);
                    $('input[name="addressId"]').val($('.address-select option:selected').val());

                    $('.alipay-btn').click();
                    layer.close(index);
                })
            } else {
                layer.msg('请选择物品进行购买');
            }
        })

        cartNum();

        loadAddress();
    })

    function cartNum() {
        $.ajax({
            url: '/reception/commodity/cartnum',
            type: 'post',
            success: function (result) {
                $('.nav-shop__circle').text(result.data);
            }
        })
    }

    function loadPrice() {
        let price = 0;

        $('.all-item:checked').each(function () {
            price += parseInt($(this).parent().next().next().next().next().children().text());
        })

        $('.all-price').text(price + '元');
    }

    function loadCart() {
        $.ajax({
            type: 'post',
            url: '/reception/commodity/loadcart',
            success: function (result) {
                const cartTable = $('.cart-table');
                console.log(result.data)
                if (result.data.length === 0) {

                } else {
                    cartTable.empty().append('<thead>\n' +
                        '                    <tr>\n' +
                        '                        <th scope="col"><input type="checkbox" class="all">全选</th>\n' +
                        '                        <th scope="col">产品</th>\n' +
                        '                        <th scope="col">价格</th>\n' +
                        '                        <th scope="col">数量</th>\n' +
                        '                        <th scope="col">小计</th>\n' +
                        '                    </tr>\n' +
                        '                    </thead>');

                    cartTable.append('<tbody>');
                    $.each(result.data, function (i, object) {
                        cartTable.append('<tr>\n' +
                            '                        <td>\n' +
                            '                            <input type="checkbox" class="all-item" value="' + object.commodityId + '">\n' +
                            '                        </td>\n' +
                            '                        <td>\n' +
                            '                            <div class="media">\n' +
                            '                                <div class="d-flex">\n' +
                            '                                    <a href="/reception/commodity/' + object.commodityId + '"><img alt="" src="' + object.commodityVo.photo + '" style="width: 80px"></a>\n' +
                            '                                </div>\n' +
                            '                                <div class="media-body">\n' +
                            '                                    <a href="/reception/commodity/' + object.commodityId + '"><p>' + object.commodityVo.title.substring(0, 12).concat('...') + '</p></a>\n' +
                            '                                </div>\n' +
                            '                            </div>\n' +
                            '                        </td>\n' +
                            '                        <td>\n' +
                            '                            <h5>' + (object.commodityVo.promotionPrice === null ? object.commodityVo.price : object.commodityVo.promotionPrice) + '元</h5>\n' +
                            '                        </td>\n' +
                            '                        <td>\n' +
                            '                            <div class="product_count">\n' +
                            '                                <input class="input-text qty" id="" maxlength="12" name="qty" title="Quantity:"\n' +
                            '                                       type="text" value="' + object.commodityNumber + '" readonly="readonly">\n' +
                            '                                <button class="increase items-count add-num"\n' +
                            '                                        type="button" value="' + object.commodityId + '"><i class="lnr lnr-chevron-up"></i></button>\n' +
                            '                                <button class="reduced items-count sub-num"\n' +
                            '                                        type="button" value="' + object.commodityId + '"><i class="lnr lnr-chevron-down"></i></button>\n' +
                            '                            </div>\n' +
                            '                        </td>\n' +
                            '                        <td>\n' +
                            '                            <h5>' + (object.commodityVo.promotionPrice === null ? object.commodityVo.price*object.commodityNumber : object.commodityVo.promotionPrice*object.commodityNumber) + '元</h5>\n' +
                            '                        </td>\n' +
                            '                        <td>\n' +
                            '                            <button style="height: 35px;border: none;background: transparent" value="' + object.commodityId + '" class="delete-btn"><div class="delete"></div></button>\n' +
                            '                        </td>\n' +
                            '                    </tr>');
                    })
                    cartTable.append('<tr>\n' +
                        '                        <td></td>\n' +
                        '                        <td></td>\n' +
                        '                        <td></td>\n' +
                        '                        <td>\n' +
                        '                            <h5>总计</h5>\n' +
                        '                        </td>\n' +
                        '                        <td>\n' +
                        '                            <h5 class="all-price">0元</h5>\n' +
                        '                        </td>\n' +
                        '                        <td></td>\n' +
                        '                    </tr>\n' +
                        '                    <tr class="shipping_area">\n' +
                        '                        <td class="d-none d-md-block"></td>\n' +
                        '                        <td></td>\n' +
                        '                        <td></td>\n' +
                        '                        <td></td>\n' +
                        '                        <td>\n' +
                        '                            <div class="shipping_box">\n' +
                        '                                <h6>支付方式<i aria-hidden="true" class="fa fa-caret-down"></i></h6>\n' +
                        '                                <ul class="list">\n' +
                        '                                    <li class="active"><a href="javascript:">支付宝</a></li>\n' +
                        '                                </ul>\n' +
                        '                            </div>\n' +
                        '                        </td>\n' +
                        '                        <td></td>\n' +
                        '                    </tr>\n' +
                        '                    <tr class="shipping_area">\n' +
                        '                        <td class="d-none d-md-block"></td>\n' +
                        '                        <td></td>\n' +
                        '                        <td></td>\n' +
                        '                        <td></td>\n' +
                        '                        <td>\n' +
                        '                            <div class="shipping_box">\n' +
                        '                                <h6>地址选择<i aria-hidden="true" class="fa fa-caret-down"></i></h6>\n' +
                        '                                <select class="address-select">\n' +
                        '                                </select>\n' +
                        '                            </div>\n' +
                        '                        </td>\n' +
                        '                        <td></td>\n' +
                        '                    </tr>\n' +
                        '                    <tr class="out_button_area">\n' +
                        '                        <td class="d-none-l"></td>\n' +
                        '                        <td class=""></td>\n' +
                        '                        <td></td>\n' +
                        '                        <td></td>\n' +
                        '                        <td></td>\n' +
                        '                        <td></td>\n' +
                        '                        <td>\n' +
                        '                            <div class="checkout_btn_inner d-flex align-items-center">\n' +
                        '                                <a class="gray_btn" href="/reception/url/index">继续购物</a>\n' +
                        '                                <a class="primary-btn ml-2 buy" href="javascript:">结算</a>\n' +
                        '                            </div>\n' +
                        '                        </td>\n' +
                        '                    </tr>');
                    cartTable.append('</tbody>');

                    loadAddress();
                }
            }
        })
    }
</script>
</body>
</html>